<main class="games-section container">
  <!-- Tabs Section -->
  <div class="game-tabs">
    <button class="tab-button" onclick="showSection('calendar')">Calendar</button>
    <button class="tab-button active" onclick="showSection('mySports')">My Sports</button>
    <button class="tab-button" onclick="showSection('otherSports')">Other Sports</button>
  </div>

  <!-- Calendar Section -->
  <section id="calendar" class="tab-content" style="display: none;">
    <div id="calendar-container">
      <div id="calendar"></div>
    </div>
  </section>

  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />

  <!-- My Sports Section -->
  <section id="mySports" class="tab-content" style="display: block;">
    {{#if isLoggedIn}}
      <section>
        <h2 class="section-heading">Recommended Games</h2>
        {{#if recommendedGames.length}}
          <div class="game-grid">
            {{#each recommendedGames}}
              <div class="game-card">
                <a href="/join/{{this._id}}">
                  <h3>{{this.title}}</h3>
                  <p>Sport: {{this.sport}}</p>
                  <p>Location: {{this.location}}</p>
                  <p>
                    Date: {{formatDate this.startTime}} |
                    Time: {{formatTime this.startTime}} - {{formatTime this.endTime}}
                  </p>
                </a>
              </div>
            {{/each}}
          </div>
        {{else}}
          <div class="no-match-box">
            <p class="no-match">Oops...No Match Found for this Selection Criteria</p>
            <p>You can host an activity & we will shout-out to the community to join in :)</p>
            <a href="/host/form" class="btn btn-success">Create Game</a>
          </div>
        {{/if}}
      </section>
    {{/if}}

    <!-- All Games -->
    <section>
      <h2 class="section-heading">All Games</h2>
      <div class="game-grid">
        {{#each allGames}}
          <div class="game-card">
            <a href="/join/{{this._id}}">
              <h3>{{this.title}}</h3>
              <p>Sport: {{this.sport}}</p>
              <p>Location: {{this.location}}</p>
              <p>
                Date: {{formatDate this.startTime}} |
                Time: {{formatTime this.startTime}} - {{formatTime this.endTime}}
              </p>
              {{#if this.host.username}}
                <p>Hosted By: {{this.host.username}}</p>
              {{/if}}
            </a>

            {{#if (eq ../hostId this.host._id)}}
              <!-- Host: Edit/Delete buttons -->
              <a href="/host/edit/{{this._id}}" class="btn btn-warning">Edit</a>
              <form action="/host/delete/{{this._id}}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this game?')">
                <button type="submit" class="btn btn-danger">Delete</button>
              </form>
            {{else}}
              {{#if (includes ../joinedGameIdStrings this._id)}}
                <!-- Already joined -->
                <form action="/join/leave/{{this._id}}" method="POST">
                  <button type="submit" class="btn btn-secondary">Leave</button>
                </form>
              {{else if (gte (length this.players) this.playersRequired)}}
                <!-- Session full and not joined -->
                <p class="full-session">ðŸš« Session is Full</p>
              {{/if}}
            {{/if}}
          </div>
        {{/each}}
      </div>
    </section>
  </section>

  <!-- Other Sports Filter -->
  <section id="otherSports" class="tab-content" style="display: none;">
    <h3>Other Sports Filter</h3>
    <p>Filter and discover new activities from other categories.</p>
  </section>

  <!-- JS Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script>
    function showSection(sectionId) {
      const sections = document.querySelectorAll('.tab-content');
      sections.forEach(sec => sec.style.display = 'none');

      const buttons = document.querySelectorAll('.tab-button');
      buttons.forEach(btn => btn.classList.remove('active'));

      document.getElementById(sectionId).style.display = 'block';
      event.target.classList.add('active');
    }

    document.addEventListener("DOMContentLoaded", function () {
      const calendarEl = document.getElementById("calendar");

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        height: "auto",
        headerToolbar: {
          left: "prev,today,next",
          center: "title",
          right: "dayGridMonth,timeGridWeek,timeGridDay"
        },
        events: {{{json calendarEvents}}}
      });

      calendar.render();
    });
  </script>
</main>
