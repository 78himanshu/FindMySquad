<div class="container my-4">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3">
      <div class="card border rounded shadow-sm">
        <div class="card-body text-center">
          <img src="{{avatar}}" alt="avatar" class="rounded-circle mb-3" width="90" height="90">
          <h5 class="fw-semibold mb-1">{{firstName}} {{lastName}}</h5>
          <small class="text-muted d-block">{{email}}</small>
          <small class="text-muted">{{gender}}</small>
        </div>

        {{!-- NEW: Follow/Unfollow Button (only when viewing someone else) --}}
          {{#unless isOwn}}{{!-- NEW --}}
            <button
              id="followBtn"
              data-user-id="{{userId}}"
              data-following="{{isFollowing}}"
              class="btn {{#if isFollowing}}btn-primary{{else}}btn-outline-primary{{/if}} mb-3"
            >
              {{#if isFollowing}}Following{{else}}Follow{{/if}}
            </button>
          {{/unless}}{{!-- NEW --}}
        



        <ul class="list-group list-group-flush">
          <li class="list-group-item bg-success text-white fw-semibold nav-btn" data-target="overview">
            <i class="bi bi-bookmark-fill me-2"></i> Overview
          </li>
          <li class="list-group-item nav-btn" data-target="edit">
            <i class="bi bi-pencil me-2"></i> Edit Profile
          </li>
          <li class="list-group-item nav-btn" data-target="bookings">
            <i class="bi bi-reply me-2"></i> Show All Bookings
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9">
      <div class="card border rounded shadow-sm">
        <div class="card-body">

          <!-- Section: Profile Overview -->
          <div id="section-overview">
            <h4 class="fw-semibold mb-3">Your Profile Overview</h4>
            <p><strong>Bio:</strong> {{bio}}</p>

            <div class="mb-3">
              <strong>Sports Interests:</strong>
              {{#each sportsInterests}}<span class="badge bg-primary me-1">{{this}}</span>{{/each}}
            </div>

            <div class="mb-3">
              <strong>Gym Preferences:</strong>
              {{#each gymPreferences}}<span class="badge bg-success me-1">{{this}}</span>{{/each}}
            </div>

            <div class="mb-3">
              <strong>Gaming Interests:</strong>
              {{#each gamingInterests}}<span class="badge bg-warning text-dark me-1">{{this}}</span>{{/each}}
            </div>

            <div class="mb-3">
              <strong>Location:</strong>
              {{#if location.city}}{{location.city}}, {{/if}}{{location.state}} {{location.zipCode}}
            </div>

            <div class="row text-center mt-4">
              <div class="col-md-4">
                <h5>{{karmaPoints}}</h5>
                <p class="text-muted">Karma Points</p>
              </div>
              <div class="col-md-4">
                <h5>{{followers.length}}</h5>
                <p class="text-muted">Followers</p>
              </div>
              <div class="col-md-4">
                <h5>{{following.length}}</h5>
                <p class="text-muted">Following</p>
              </div>
            </div>

            {{#if achievements.length}}
            <div class="mt-4">
              <strong>Achievements:</strong>
              <ul>{{#each achievements}}<li>{{this}}</li>{{/each}}</ul>
            </div>
            {{/if}}
          </div>

          <!-- Section: Edit Profile -->
          <div id="section-edit" class="d-none">
            <h4 class="fw-semibold mb-3">Edit Your Profile</h4>
            {{> editProfileForm }}
          </div>

          <!-- Section: Bookings -->
          {{!-- <div id="section-bookings" class="d-none">
            <h4 class="fw-semibold mb-3">Your Bookings</h4>
            {{> bookingList }}
          </div> --}}

        </div>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navButtons = document.querySelectorAll('.nav-btn');
    const sections = ['overview', 'edit'];

    navButtons.forEach(btn => {
      btn.addEventListener('click', function () {
        const target = this.getAttribute('data-target');

        // If user clicked "Show All Bookings", redirect to /profile/bookings
        if (target === 'bookings') {
          return window.location.href = '/profile/bookings';
        }

        // Otherwise toggle inline sections
        sections.forEach(id => {
          const el = document.getElementById(`section-${id}`);
          if (el) el.classList.add('d-none');
        });
        const sectionEl = document.getElementById(`section-${target}`);
        if (sectionEl) sectionEl.classList.remove('d-none');

        // Sidebar highlight
        navButtons.forEach(b => b.classList.remove('bg-success', 'text-white'));
        this.classList.add('bg-success', 'text-white');
      });
    });


    const followBtn = document.getElementById('followBtn');
    if (followBtn) {
      followBtn.addEventListener('click', async () => {
        const targetId    = followBtn.dataset.userId;
        const isFollowing = followBtn.dataset.following === 'true';
        const action      = isFollowing ? 'unfollow' : 'follow';

        try {
          const res  = await fetch(`/profile/${action}/${targetId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include'
          });
          const json = await res.json();
          if (!res.ok) throw new Error(json.error || 'Failed to update follow status');

          // Toggle UI
          followBtn.dataset.following = (!isFollowing).toString();
          followBtn.textContent       = isFollowing ? 'Follow' : 'Following';
          followBtn.classList.toggle('btn-primary');
          followBtn.classList.toggle('btn-outline-primary');

          // Update follower count
          document.getElementById('followersCount').textContent = json.followersCount;
        } catch (err) {
          alert(err.message);
        }
      });
    }



  });
</script>

<script src="/js/userProfile.js"></script>

